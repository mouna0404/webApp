import { Component, Input } from '@angular/core';
import { NavigationEnd, PRIMARY_OUTLET } from '@angular/router';
import { filter, map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "./ng7-mat-breadcrumb.service";
import * as i3 from "@angular/material/toolbar";
import * as i4 from "@angular/material/list";
import * as i5 from "@angular/common";
export class Ng7MatBreadcrumbComponent {
    constructor(activatedRoute, router, ng7MatBreadcrumbService) {
        this.activatedRoute = activatedRoute;
        this.router = router;
        this.ng7MatBreadcrumbService = ng7MatBreadcrumbService;
        this.breadcrumb = [];
        this.bgColor = '#eee';
        this.fontSize = '18px';
        this.fontColor = '#0275d8';
        this.lastLinkColor = '#000';
        this.symbol = ' / ';
        this.breadCrumbData();
    }
    ngOnInit() {
        this.ng7MatBreadcrumbService.breadcrumbLabels.subscribe((labelData) => {
            for (const label in labelData) {
                if (labelData.hasOwnProperty(label)) {
                    this.breadcrumb.map((crumb) => {
                        const labelParams = crumb.label.match(/[^{{]+(?=\}})/g);
                        if (labelParams) {
                            for (const labelParam of labelParams) {
                                const dynamicData = labelData[label];
                                if (labelParam === label) {
                                    crumb.label = crumb.label.replace('{{' + labelParam + '}}', dynamicData);
                                }
                            }
                        }
                    });
                }
            }
        });
        this.ng7MatBreadcrumbService.newBreadcrumb.subscribe((breadcrumb) => {
            if (breadcrumb.length > 0) {
                this.updateData(this.activatedRoute, breadcrumb);
            }
        });
    }
    breadCrumbData() {
        this.router.events
            .pipe(filter(event => event instanceof NavigationEnd))
            .pipe(map(() => this.activatedRoute))
            .pipe(map((route) => {
            while (route.firstChild) {
                route = route.firstChild;
            }
            return route;
        }))
            .pipe(filter(route => route.outlet === PRIMARY_OUTLET))
            .subscribe(route => {
            this.params = route.snapshot.params;
            this.updateData(route, null);
        });
    }
    updateData(route, newBreadcrumb) {
        if (route.snapshot.data.breadcrumb || newBreadcrumb) {
            const data = route.snapshot.data.breadcrumb ? route.snapshot.data.breadcrumb : newBreadcrumb;
            const breadcrumb = (JSON.parse(JSON.stringify(data)));
            breadcrumb.map((crumb) => {
                const urlChunks = crumb.url.split('/');
                for (const chunk of urlChunks) {
                    if (chunk.includes(':')) {
                        const paramID = chunk.replace(':', '');
                        // const routerParamID = route.snapshot.params[paramID];
                        const routerParamID = this.params[paramID];
                        crumb.url = crumb.url.replace(`:${paramID}`, routerParamID);
                    }
                }
                const labelParams = crumb.label.match(/[^{{]+(?=\}})/g);
                if (labelParams) {
                    for (const labelParam of labelParams) {
                        // const routerParamID = route.snapshot.params[labelParam.trim()];
                        const routerParamID = this.params[labelParam.trim()];
                        if (routerParamID) {
                            crumb.label = crumb.label.replace('{{' + labelParam + '}}', routerParamID);
                        }
                        else {
                            // crumb.label = crumb.label.replace('{{' + labelParam + '}}', '');
                        }
                    }
                }
            });
            this.breadcrumb = breadcrumb;
        }
        else {
            this.breadcrumb = [];
        }
    }
}
Ng7MatBreadcrumbComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.1.1", ngImport: i0, type: Ng7MatBreadcrumbComponent, deps: [{ token: i1.ActivatedRoute }, { token: i1.Router }, { token: i2.Ng7MatBreadcrumbService }], target: i0.ɵɵFactoryTarget.Component });
Ng7MatBreadcrumbComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.1.1", type: Ng7MatBreadcrumbComponent, selector: "app-ng7-mat-breadcrumb", inputs: { bgColor: "bgColor", fontSize: "fontSize", fontColor: "fontColor", lastLinkColor: "lastLinkColor", symbol: "symbol" }, ngImport: i0, template: "<mat-toolbar class=\"mat-bread-crumb\" [ngStyle]=\"{'background-color': bgColor}\">\r\n    <mat-list class=\"mat-bread-crumb-list\" *ngIf=\"breadcrumb.length\">\r\n        <mat-list-item>\r\n            <span class=\"mat-bread-crumb-spacer\">\r\n                <span *ngFor=\"let item of breadcrumb; let i = index\">\r\n                    <a *ngIf=\"item?.url\" [routerLink]=\"item?.url\" class=\"mat-bread-crumb-list-item\" [ngStyle]=\"{'font-size': fontSize}\" [ngStyle]=\"{'color': fontColor}\">{{ item.label }}</a>\r\n                    <span *ngIf=\"!item?.url\" class=\"mat-bread-crumb-list-item\" [ngStyle]=\"{'font-size': fontSize}\"  [ngStyle]=\"{'color': lastLinkColor}\">{{ item.label }}</span>\r\n                    <span *ngIf=\"breadcrumb.length !== i+1\">{{symbol}}</span>\r\n                </span>\r\n            </span>\r\n        </mat-list-item>\r\n    </mat-list>\r\n</mat-toolbar>", styles: [".mat-bread-crumb{height:30px;background-color:#f1efeb}.mat-bread-crumb-list{padding-bottom:10px}.mat-bread-crumb-list-item{font-size:15px}.mat-bread-crumb-spacer{margin-left:-20px}"], components: [{ type: i3.MatToolbar, selector: "mat-toolbar", inputs: ["color"], exportAs: ["matToolbar"] }, { type: i4.MatList, selector: "mat-list, mat-action-list", inputs: ["disableRipple", "disabled"], exportAs: ["matList"] }, { type: i4.MatListItem, selector: "mat-list-item, a[mat-list-item], button[mat-list-item]", inputs: ["disableRipple", "disabled"], exportAs: ["matListItem"] }], directives: [{ type: i5.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.RouterLinkWithHref, selector: "a[routerLink],area[routerLink]", inputs: ["routerLink", "target", "queryParams", "fragment", "queryParamsHandling", "preserveFragment", "skipLocationChange", "replaceUrl", "state", "relativeTo"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.1.1", ngImport: i0, type: Ng7MatBreadcrumbComponent, decorators: [{
            type: Component,
            args: [{
                    // tslint:disable-next-line: component-selector
                    selector: 'app-ng7-mat-breadcrumb',
                    templateUrl: './ng7-mat-breadcrumb.component.html',
                    styleUrls: ['./ng7-mat-breadcrumb.component.css']
                }]
        }], ctorParameters: function () { return [{ type: i1.ActivatedRoute }, { type: i1.Router }, { type: i2.Ng7MatBreadcrumbService }]; }, propDecorators: { bgColor: [{
                type: Input
            }], fontSize: [{
                type: Input
            }], fontColor: [{
                type: Input
            }], lastLinkColor: [{
                type: Input
            }], symbol: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmc3LW1hdC1icmVhZGNydW1iLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25nNy1tYXQtYnJlYWRjcnVtYi9zcmMvbGliL25nNy1tYXQtYnJlYWRjcnVtYi5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZzctbWF0LWJyZWFkY3J1bWIvc3JjL2xpYi9uZzctbWF0LWJyZWFkY3J1bWIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUEwQixhQUFhLEVBQUUsY0FBYyxFQUFvQixNQUFNLGlCQUFpQixDQUFDO0FBQzFHLE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFZLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7QUFVdkQsTUFBTSxPQUFPLHlCQUF5QjtJQVVwQyxZQUNVLGNBQThCLEVBQzlCLE1BQWMsRUFDZCx1QkFBZ0Q7UUFGaEQsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO1FBWDFELGVBQVUsR0FBaUIsRUFBRSxDQUFDO1FBQ3JCLFlBQU8sR0FBRyxNQUFNLENBQUM7UUFDakIsYUFBUSxHQUFHLE1BQU0sQ0FBQztRQUNsQixjQUFTLEdBQUcsU0FBUyxDQUFDO1FBQ3RCLGtCQUFhLEdBQUcsTUFBTSxDQUFDO1FBQ3ZCLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFRdEIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQ3BFLEtBQUssTUFBTSxLQUFLLElBQUksU0FBUyxFQUFFO2dC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S0FJVSxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIsIE5hdmlnYXRpb25FbmQsIFBSSU1BUllfT1VUTEVULCBSb3V0ZXNSZWNvZ25pemVkIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIG1lcmdlTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBCcmVhZGNydW1iIH0gZnJvbSAnLi9icmVhZGNydW1iLm1vZGVsJztcclxuaW1wb3J0IHsgTmc3TWF0QnJlYWRjcnVtYlNlcnZpY2UgfSBmcm9tICcuL25nNy1tYXQtYnJlYWRjcnVtYi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgZnJvbSB9IGZyb20gJ3J4anMnO1xyXG5AQ29tcG9uZW50KHtcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBjb21wb25lbnQtc2VsZWN0b3JcclxuICBzZWxlY3RvcjogJ2FwcC1uZzctbWF0LWJyZWFkY3J1bWInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9uZzctbWF0LWJyZWFkY3J1bWIuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL25nNy1tYXQtYnJlYWRjcnVtYi5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIE5nN01hdEJyZWFkY3J1bWJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBicmVhZGNydW1iOiBCcmVhZGNydW1iW10gPSBbXTtcclxuICBASW5wdXQoKSBiZ0NvbG9yID0gJyNlZWUnO1xyXG4gIEBJbnB1dCgpIGZvbnRTaXplID0gJzE4cHgnO1xyXG4gIEBJbnB1dCgpIGZvbnRDb2xvciA9ICcjMDI3NWQ4JztcclxuICBASW5wdXQoKSBsYXN0TGlua0NvbG9yID0gJyMwMDAnO1xyXG4gIEBJbnB1dCgpIHN5bWJvbCA9ICcgLyAnO1xyXG4gIHBhcmFtczogeyBba2V5OiBzdHJpbmddOiBhbnk7IH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXHJcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxyXG4gICAgcHJpdmF0ZSBuZzdNYXRCcmVhZGNydW1iU2VydmljZTogTmc3TWF0QnJlYWRjcnVtYlNlcnZpY2VcclxuICApIHtcclxuICAgIHRoaXMuYnJlYWRDcnVtYkRhdGEoKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5uZzdNYXRCcmVhZGNydW1iU2VydmljZS5icmVhZGNydW1iTGFiZWxzLnN1YnNjcmliZSgobGFiZWxEYXRhKSA9PiB7XHJcbiAgICAgIGZvciAoY29uc3QgbGFiZWwgaW4gbGFiZWxEYXRhKSB7XHJcbiAgICAgICAgaWYgKGxhYmVsRGF0YS5oYXNPd25Qcm9wZXJ0eShsYWJlbCkpIHtcclxuICAgICAgICAgIHRoaXMuYnJlYWRjcnVtYi5tYXAoKGNydW1iKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsUGFyYW1zID0gY3J1bWIubGFiZWwubWF0Y2goL1tee3tdKyg/PVxcfX0pL2cpO1xyXG4gICAgICAgICAgICBpZiAobGFiZWxQYXJhbXMpIHtcclxuICAgICAgICAgICAgICBmb3IgKGNvbnN0IGxhYmVsUGFyYW0gb2YgbGFiZWxQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGR5bmFtaWNEYXRhID0gbGFiZWxEYXRhW2xhYmVsXTtcclxuICAgICAgICAgICAgICAgIGlmIChsYWJlbFBhcmFtID09PSBsYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICBjcnVtYi5sYWJlbCA9IGNydW1iLmxhYmVsLnJlcGxhY2UoJ3t7JyArIGxhYmVsUGFyYW0gKyAnfX0nLCBkeW5hbWljRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMubmc3TWF0QnJlYWRjcnVtYlNlcnZpY2UubmV3QnJlYWRjcnVtYi5zdWJzY3JpYmUoKGJyZWFkY3J1bWI6IEJyZWFkY3J1bWJbXSkgPT4ge1xyXG4gICAgICBpZiAoYnJlYWRjcnVtYi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVEYXRhKHRoaXMuYWN0aXZhdGVkUm91dGUsIGJyZWFkY3J1bWIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGJyZWFkQ3J1bWJEYXRhKCk6IHZvaWQge1xyXG4gICAgdGhpcy5yb3V0ZXIuZXZlbnRzXHJcbiAgICAgIC5waXBlKGZpbHRlcihldmVudCA9PiBldmVudCBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpKVxyXG4gICAgICAucGlwZShtYXAoKCkgPT4gdGhpcy5hY3RpdmF0ZWRSb3V0ZSkpXHJcbiAgICAgIC5waXBlKG1hcCgocm91dGUpID0+IHtcclxuICAgICAgICB3aGlsZSAocm91dGUuZmlyc3RDaGlsZCkgeyByb3V0ZSA9IHJvdXRlLmZpcnN0Q2hpbGQ7IH1cclxuICAgICAgICByZXR1cm4gcm91dGU7XHJcbiAgICAgIH0pKVxyXG4gICAgICAucGlwZShmaWx0ZXIocm91dGUgPT4gcm91dGUub3V0bGV0ID09PSBQUklNQVJZX09VVExFVCkpXHJcbiAgICAgIC5zdWJzY3JpYmUocm91dGUgPT4ge1xyXG4gICAgICAgIHRoaXMucGFyYW1zID0gcm91dGUuc25hcHNob3QucGFyYW1zO1xyXG4gICAgICAgIHRoaXMudXBkYXRlRGF0YShyb3V0ZSwgbnVsbCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVEYXRhKHJvdXRlLCBuZXdCcmVhZGNydW1iKTogdm9pZCB7XHJcbiAgICBpZiAocm91dGUuc25hcHNob3QuZGF0YS5icmVhZGNydW1iIHx8IG5ld0JyZWFkY3J1bWIpIHtcclxuICAgICAgY29uc3QgZGF0YSA9IHJvdXRlLnNuYXBzaG90LmRhdGEuYnJlYWRjcnVtYiA/IHJvdXRlLnNuYXBzaG90LmRhdGEuYnJlYWRjcnVtYiA6IG5ld0JyZWFkY3J1bWI7XHJcbiAgICAgIGNvbnN0IGJyZWFkY3J1bWIgPSAoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSkpO1xyXG4gICAgICBicmVhZGNydW1iLm1hcCgoY3J1bWIpID0+IHtcclxuXHJcbiAgICAgICAgY29uc3QgdXJsQ2h1bmtzID0gY3J1bWIudXJsLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgZm9yIChjb25zdCBjaHVuayBvZiB1cmxDaHVua3MpIHtcclxuICAgICAgICAgIGlmIChjaHVuay5pbmNsdWRlcygnOicpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtSUQgPSBjaHVuay5yZXBsYWNlKCc6JywgJycpO1xyXG4gICAgICAgICAgICAvLyBjb25zdCByb3V0ZXJQYXJhbUlEID0gcm91dGUuc25hcHNob3QucGFyYW1zW3BhcmFtSURdO1xyXG4gICAgICAgICAgICBjb25zdCByb3V0ZXJQYXJhbUlEID0gdGhpcy5wYXJhbXNbcGFyYW1JRF07XHJcbiAgICAgICAgICAgIGNydW1iLnVybCA9IGNydW1iLnVybC5yZXBsYWNlKGA6JHtwYXJhbUlEfWAsIHJvdXRlclBhcmFtSUQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbGFiZWxQYXJhbXMgPSBjcnVtYi5sYWJlbC5tYXRjaCgvW157e10rKD89XFx9fSkvZyk7XHJcbiAgICAgICAgaWYgKGxhYmVsUGFyYW1zKSB7XHJcbiAgICAgICAgICBmb3IgKGNvbnN0IGxhYmVsUGFyYW0gb2YgbGFiZWxQYXJhbXMpIHtcclxuICAgICAgICAgICAgLy8gY29uc3Qgcm91dGVyUGFyYW1JRCA9IHJvdXRlLnNuYXBzaG90LnBhcmFtc1tsYWJlbFBhcmFtLnRyaW0oKV07XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlclBhcmFtSUQgPSB0aGlzLnBhcmFtc1tsYWJlbFBhcmFtLnRyaW0oKV07XHJcbiAgICAgICAgICAgIGlmIChyb3V0ZXJQYXJhbUlEKSB7XHJcbiAgICAgICAgICAgICAgY3J1bWIubGFiZWwgPSBjcnVtYi5sYWJlbC5yZXBsYWNlKCd7eycgKyBsYWJlbFBhcmFtICsgJ319Jywgcm91dGVyUGFyYW1JRCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gY3J1bWIubGFiZWwgPSBjcnVtYi5sYWJlbC5yZXBsYWNlKCd7eycgKyBsYWJlbFBhcmFtICsgJ319JywgJycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuYnJlYWRjcnVtYiA9IGJyZWFkY3J1bWI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmJyZWFkY3J1bWIgPSBbXTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiPG1hdC10b29sYmFyIGNsYXNzPVwibWF0LWJyZWFkLWNydW1iXCIgW25nU3R5bGVdPVwieydiYWNrZ3JvdW5kLWNvbG9yJzogYmdDb2xvcn1cIj5cclxuICAgIDxtYXQtbGlzdCBjbGFzcz1cIm1hdC1icmVhZC1jcnVtYi1saXN0XCIgKm5nSWY9XCJicmVhZGNydW1iLmxlbmd0aFwiPlxyXG4gICAgICAgIDxtYXQtbGlzdC1pdGVtPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hdC1icmVhZC1jcnVtYi1zcGFjZXJcIj5cclxuICAgICAgICAgICAgICAgIDxzcGFuICpuZ0Zvcj1cImxldCBpdGVtIG9mIGJyZWFkY3J1bWI7IGxldCBpID0gaW5kZXhcIj5cclxuICAgICAgICAgICAgICAgICAgICA8YSAqbmdJZj1cIml0ZW0/LnVybFwiIFtyb3V0ZXJMaW5rXT1cIml0ZW0/LnVybFwiIGNsYXNzPVwibWF0LWJyZWFkLWNydW1iLWxpc3QtaXRlbVwiIFtuZ1N0eWxlXT1cInsnZm9udC1zaXplJzogZm9udFNpemV9XCIgW25nU3R5bGVdPVwieydjb2xvcic6IGZvbnRDb2xvcn1cIj57eyBpdGVtLmxhYmVsIH19PC9hPlxyXG4gICAgICAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwiIWl0ZW0/LnVybFwiIGNsYXNzPVwibWF0LWJyZWFkLWNydW1iLWxpc3QtaXRlbVwiIFtuZ1N0eWxlXT1cInsnZm9udC1zaXplJzogZm9udFNpemV9XCIgIFtuZ1N0eWxlXT1cInsnY29sb3InOiBsYXN0TGlua0NvbG9yfVwiPnt7IGl0ZW0ubGFiZWwgfX08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJicmVhZGNydW1iLmxlbmd0aCAhPT0gaSsxXCI+e3tzeW1ib2x9fTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgPC9zcGFuPlxyXG4gICAgICAgIDwvbWF0LWxpc3QtaXRlbT5cclxuICAgIDwvbWF0LWxpc3Q+XHJcbjwvbWF0LXRvb2xiYXI+Il19